<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Wage Pro - Clock Version</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyByv5JyDjRGQVgo3MZe4QhIXS7TPePu50w&libraries=places"></script>

    <style>
        :root { --p: #4361ee; --s: #2ecc71; --d: #e74c3c; --bg: #f4f7fe; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 120px; }
        .container { padding: 15px; }
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; }
        #map { height: 300px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #ddd; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 10px; font-size: 15px; }
        .btn-p { background: var(--p); color: white; }
        .btn-s { background: var(--s); color: white; }
        .btn-d { background: var(--d); color: white; }
        .search-box { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 10px; box-sizing: border-box; font-size: 16px; }
        .log-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; align-items: center; }
        #ad-banner { position: fixed; bottom: 0; left: 0; width: 100%; height: 90px; background: #eee; z-index: 1000; text-align: center; }
        #timer-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); color: white; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 2000; }
        /* Time Picker Modal Style */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 3000; width: 90%; max-width: 400px; background: white; border-radius: 20px; padding: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); }
        .overlay-bg { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2999; }
    </style>
</head>
<body>

<div id="timer-overlay">
    <h2>á€€á€¼á€±á€¬á€ºá€„á€¼á€¬á€•á€¼á€á€”á€±á€á€Šá€º...</h2>
    <h1 id="countdown" style="font-size: 80px;">5</h1>
</div>

<div id="modal-bg" class="overlay-bg"></div>
<div id="time-modal" class="modal">
    <h3 id="modal-title" style="margin-top:0;">á€¡á€á€»á€­á€”á€ºá€›á€½á€±á€¸á€•á€«</h3>
    <label style="font-size: 12px; color: #666;">á€”á€¬á€›á€®á€•á€¯á€¶á€€á€­á€¯á€”á€¾á€­á€•á€ºá á€¡á€á€»á€­á€”á€ºá€›á€½á€±á€¸á€•á€«</label>
    <input type="time" id="picker-time" class="search-box" style="font-size: 24px; text-align: center; margin-top: 10px;">
    <div id="wage-input-div" style="display:none;">
        <input type="number" id="picker-wage" class="search-box" placeholder="á€›á€›á€¾á€­á€á€Šá€·á€º á€á€„á€ºá€„á€½á€± (Ks)">
    </div>
    <button class="btn btn-s" onclick="confirmTime()">á€¡á€á€Šá€ºá€•á€¼á€¯á€™á€Šá€º</button>
    <button class="btn btn-d" onclick="closeModal()" style="background:#888;">á€•á€­á€á€ºá€™á€Šá€º</button>
</div>

<div class="container">
    <div class="card">
        <h3>ğŸ“ á€¡á€œá€¯á€•á€ºá€›á€¯á€¶á€á€Šá€ºá€”á€±á€›á€¬á€á€á€ºá€™á€¾á€á€ºá€á€¼á€„á€ºá€¸</h3>
        <input id="pac-input" class="search-box" type="text" placeholder="á€”á€±á€›á€¬á€¡á€™á€Šá€ºá€›á€­á€¯á€€á€ºá€›á€¾á€¬á€•á€«">
        <div id="map"></div>
        <button class="btn btn-p" onclick="saveLocation()">á€¤á€”á€±á€›á€¬á€€á€­á€¯ á€¡á€á€Šá€ºá€•á€¼á€¯á€™á€Šá€º</button>
    </div>

    <div class="card">
        <h3>ğŸ’° á€”á€±á€·á€…á€‰á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸</h3>
        <button class="btn btn-s" onclick="askCheckIn()">á€¡á€œá€¯á€•á€ºá€á€€á€ºá€á€»á€­á€”á€º á€–á€¼á€Šá€·á€ºá€™á€Šá€º</button>
        <button class="btn btn-d" onclick="askCheckOut()">á€¡á€œá€¯á€•á€ºá€†á€„á€ºá€¸á€á€»á€­á€”á€º á€–á€¼á€Šá€·á€ºá€™á€Šá€º</button>
    </div>

    <div class="card">
        <h3>ğŸ“Š áá… á€›á€€á€ºá€…á€¬ á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸á€™á€¾á€á€ºá€á€™á€ºá€¸</h3>
        <div id="log-list"></div>
        <hr>
        <h4 id="total-wage" style="font-size: 20px; color: var(--p);">á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸: 0 Ks</h4>
        <button class="btn btn-d" style="background:#666; margin-top: 10px;" onclick="clearLogs()">áá… á€›á€€á€ºá€…á€¬ á€™á€¾á€á€ºá€á€™á€ºá€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸á€–á€»á€€á€ºá€™á€Šá€º</button>
    </div>

    <div class="card">
        <button class="btn btn-p" style="background: #555;" onclick="showAd()">More App</button>
    </div>
</div>

<div id="ad-banner">
    <script>
        atOptions = { 'key' : 'd5951856266fe1332c19ba818b040cb3', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
    </script>
    <script src="https://www.highperformanceformat.com/d5951856266fe1332c19ba818b040cb3/invoke.js"></script>
</div>

<script>
    // Firebase Setup
    const firebaseConfig = {
        apiKey: "AIzaSyDIjR647lFhyE5mX8BfbPWQ64KAqGZeLUE",
        authDomain: "smart-note-66b56.firebaseapp.com",
        projectId: "smart-note-66b56",
        storageBucket: "smart-note-66b56.firebasestorage.app",
        messagingSenderId: "197796134024",
        appId: "1:197796134024:web:c8c74f56ef75bde398333d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let map, marker, autocomplete, currentType = '';
    let selectedPos = { lat: 13.7563, lng: 100.5018 };

    // Google Maps Initialization
    function initMap() {
        try {
            map = new google.maps.Map(document.getElementById("map"), { center: selectedPos, zoom: 15, mapTypeControl: false });
            marker = new google.maps.Marker({ position: selectedPos, map: map, draggable: true });

            const input = document.getElementById("pac-input");
            autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.addListener("place_changed", () => {
                const place = autocomplete.getPlace();
                if (place.geometry) {
                    map.setCenter(place.geometry.location);
                    marker.setPosition(place.geometry.location);
                    selectedPos = place.geometry.location.toJSON();
                }
            });

            marker.addListener('dragend', () => { selectedPos = marker.getPosition().toJSON(); });
            loadLogs();
        } catch (e) { console.error("Map Error:", e); }
    }

    function saveLocation() {
        localStorage.setItem('factoryPos', JSON.stringify(selectedPos));
        alert("á€¡á€œá€¯á€•á€ºá€›á€¯á€¶á€”á€±á€›á€¬ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹");
    }

    // Time Picker Logic
    function askCheckIn() {
        currentType = 'in';
        document.getElementById('modal-title').innerText = "á€¡á€œá€¯á€•á€ºá€á€€á€ºá€á€»á€­á€”á€º á€›á€½á€±á€¸á€•á€«";
        document.getElementById('wage-input-div').style.display = 'none';
        document.getElementById('time-modal').style.display = 'block';
        document.getElementById('modal-bg').style.display = 'block';
    }

    function askCheckOut() {
        currentType = 'out';
        document.getElementById('modal-title').innerText = "á€¡á€œá€¯á€•á€ºá€†á€„á€ºá€¸á€á€»á€­á€”á€º á€›á€½á€±á€¸á€•á€«";
        document.getElementById('wage-input-div').style.display = 'block';
        document.getElementById('time-modal').style.display = 'block';
        document.getElementById('modal-bg').style.display = 'block';
    }

    async function confirmTime() {
        const timeInput = document.getElementById('picker-time').value;
        const wageInput = document.getElementById('picker-wage').value;
        if(!timeInput) return alert("á€¡á€á€»á€­á€”á€ºá€›á€½á€±á€¸á€•á€±á€¸á€•á€«");

        if(currentType === 'in') {
            await db.collection("wages").add({ type: 'in', time: timeInput, date: new Date().toLocaleDateString(), ts: Date.now() });
        } else {
            await db.collection("wages").add({ type: 'out', time: timeInput, wage: parseInt(wageInput) || 0, date: new Date().toLocaleDateString(), ts: Date.now() });
        }
        closeModal();
        loadLogs();
    }

    function closeModal() {
        document.getElementById('time-modal').style.display = 'none';
        document.getElementById('modal-bg').style.display = 'none';
    }

    // Load Logs
    async function loadLogs() {
        const snap = await db.collection("wages").orderBy("ts", "desc").limit(30).get();
        let html = ''; let total = 0;
        snap.forEach(doc => {
            const d = doc.data();
            if(d.type === 'out') total += (d.wage || 0);
            html += `<div class="log-item">
                <span><b>${d.date}</b><br><small>${d.time}</small></span>
                <span>${d.wage ? d.wage + ' Ks' : '<span style="color:var(--s)">Check-in</span>'} 
                <button onclick="deleteDoc('${doc.id}')" style="color:var(--d); border:none; background:none; font-size:18px; margin-left:10px;">âœ–</button></span>
            </div>`;
        });
        document.getElementById('log-list').innerHTML = html || '<p style="text-align:center; color:#999;">á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€›á€¾á€­á€á€±á€¸á€•á€«á‹</p>';
        document.getElementById('total-wage').innerText = `á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸: ${total.toLocaleString()} Ks`;
    }

    async function deleteDoc(id) {
        if(confirm("á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) { await db.collection("wages").doc(id).delete(); loadLogs(); }
    }

    async function clearLogs() {
        if(confirm("áá… á€›á€€á€ºá€…á€¬ á€™á€¾á€á€ºá€á€™á€ºá€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€»á€€á€ºá€™á€Šá€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
            const snap = await db.collection("wages").get();
            const batch = db.batch();
            snap.forEach(doc => batch.delete(doc.ref));
            await batch.commit();
            loadLogs();
        }
    }

    function showAd() {
        document.getElementById('timer-overlay').style.display = 'flex';
        let count = 5;
        const timer = setInterval(() => {
            count--;
            document.getElementById('countdown').innerText = count;
            if(count <= 0) {
                clearInterval(timer);
                window.location.href = "https://daily-y-app.github.io/Apk-downlode/";
            }
        }, 1000);
    }

    google.maps.event.addDomListener(window, 'load', initMap);
</script>
</body>
  </html>
